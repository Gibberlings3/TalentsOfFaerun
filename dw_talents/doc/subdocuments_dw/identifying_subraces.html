<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Identifying subraces</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" href="files/g3readme_cam_022916_dwedit.css" type="text/css" />
<link href="files/g3icon.ico" rel="icon" type="image/bmp" />
</head>
<body>
<div id="container">
  <div class="ribbon_menu">
    
    <span><img src="files/g3_logo_2018.gif" width="305" height="83" alt="G3" /></span> </div>
<div class="ribbon_bubble">
    <div class="ribbon_rectangle">
<h1>Identifying subraces</h1>
</div>
    <div class="ribbon_triangle-l"></div>
    <div class="ribbon_triangle-r"></div>

<div class="section">
<a id="top" name="top"></a>
<p>This is a quick note for modders who want to detect or use subraces in their own mods.</p>

</p>
<p>Subraces are identified by a combination of two variables: (i) their race; (ii) the value of stat 134(=EXTRAPROFICIENCY20). (For instance, in a clean install of ToF, gold dwarves are race=4 (DWARF), stat=1; aasimar are race=185 (AASIMAR), stat=1). Detecting them is then just a matter of checking both variables; for instance,
<div class="code">
<pre><code>Race(Player1,4)CheckStat(Player1,1,EXTRAPROFICIENCY20)
</code></pre></div>
returns true iff Player1 is a gold dwarf.</p>
<p>The race and stat values for a given subrace are stored in the table 'weidu_external/data/dw_shared/dw_subrace_ids.2da'. It is <strong>not a good idea</strong> to assume their values are fixed; your mod should collect them at install time. The simplest way is to use a function generated by ToF's subrace component. In the ALWAYS block of your mod, put this include instruction:
<div class="code">
<pre><code>INCLUDE "weidu_external/data/dw_shared/subrace_ids.tpa"
</code></pre></div>
This defines an action/patch function 'subrace_ids', which you use like this:
<div class="code">
<pre><code>LAF subrace_ids
STR_VAR subrace=dwarf_gold 
RET 
	race_id 
	subrace_id 
END
</code></pre></div>
Assuming the subrace 'dwarf_gold' is defined in dw_subrace_ids.2da, this will spit out its race ('race_id') and stat value ('subrace_id'). If it doesn't exist, both values will be -1. (You can also return 'success', which is 1 if the subrace is defined and 0 otherwise.)</p>
<p>If you want to give a subrace to a joinable NPC, it's as simple as setting the race and stat correctly. Note that the subrace component in ToF only does anything to <strong>joinable</strong> NPCs (and only when they join the party) - there is no point assigning subraces to non-joinables.</p>
<p>It is admittedly a bit problematic that ToF is pretty late in the install order, later than most NPC mods for instance. If you want your mod to apply a subrace to an NPC, a simple way is to ask me - all I need is the subrace and the NPC's dv. If you want to do something more complicated, maybe talk to me.</p>
</div>
</div>
</body>